(function(){var b=YAHOO.util.Dom,z=YAHOO.util.Event;var r=Alfresco.util.encodeHTML,w=Alfresco.util.isValueSet;Alfresco.DocumentListViewRenderer=function(A,B){this.name=A;this.parentDocumentList=B;this.parentElementIdSuffix="-documents";this.rowClassName="yui-dt-rec";this.actionsCssClassName=this.name;this.actionsColumnWidth=200;this.actionsSplitAtModifier=1;this.thumbnailColumnWidth=100;this.buttonElementIdSuffix="-"+this.name+"View";this.buttonCssClass=this.name+"-view";this.metadataBannerViewName=this.name;this.metadataLineViewName=this.name;return this};Alfresco.DocumentListViewRenderer.prototype={setupRenderer:function l(A){b.addClass(A.id+this.buttonElementIdSuffix,this.buttonCssClass)},renderView:function p(C,A,B,D){YAHOO.util.Dom.setStyle(C.id+this.parentElementIdSuffix,"display","");C.widgets.dataTable.onDataReturnInitializeTable.call(C.widgets.dataTable,A,B,D)},destroyView:function j(C,A,B,D){YAHOO.util.Dom.setStyle(C.id+this.parentElementIdSuffix,"display","none")},renderCellSelected:function a(J,H,L,F,B){b.setStyle(H,"width",F.width+"px");b.setStyle(H.parentNode,"width",F.width+"px");var C=L.getData("jsNode"),I=C.nodeRef,A=L.getData("displayName"),E=document.createElement("input"),G=document.createElement("label");E.id="checkbox-"+L.getId();E.type="checkbox";E.name="fileChecked";E.value=I;E.checked=J.selectedFiles[I]?true:false;G.id="label_for_"+E.id;G.style.fontSize="0em";G.innerHTML=(E.checked?J.msg("checkbox.uncheck"):J.msg("checkbox.check"))+" "+A;G.setAttribute("for",E.id);H.innerHTML="";H.appendChild(G);H.appendChild(E);z.addListener(E,"click",function(M){G.innerHTML=(E.checked?J.msg("checkbox.uncheck"):J.msg("checkbox.check"))+" "+A},E,true);var K=b.getAncestorByTagName(H,"tr");z.addListener(E,"focus",function(){D(this);this.onEventHighlightRow({target:K})},this.parentDocumentList,true);new YAHOO.util.KeyListener(E,{keys:YAHOO.util.KeyListener.KEY.TAB,shift:true},{fn:function(){D(this);var M=b.getPreviousSibling(K);if(M!==null){this.onEventHighlightRow({target:M})}},scope:this.parentDocumentList,correctScope:true},"keydown").enable();function D(N){var O=b.getElementsByClassName("yui-dt-highlighted","tr",b.getAncestorByTagName(K,"tbody"));for(var M=0;M<O.length;M++){N.onEventUnhighlightRow({target:O[M]})}}},renderCellStatus:function n(L,J,M,F,A){b.setStyle(J,"width",F.width+"px");b.setStyle(J.parentNode,"width",F.width+"px");var D=M.getData(),B=D.jsNode,I=D.indicators,H,G,E="";if(I&&I.length>0){for(var C=0,K=I.length;C<K;C++){H=I[C];G=Alfresco.util.message(H.label,L.name,H.labelParams);G=Alfresco.util.substituteDotNotation(G,D);E+='<div class="status">';if(H.action){E+='<a class="indicator-action" data-action="'+H.action+'">'}E+='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/indicators/"+H.icon+'" title="'+r(G)+'" alt="'+H.id+'" />';if(H.action){E+="</a>"}E+="</div>"}}J.innerHTML=E},renderCellThumbnail:function d(N,M,O,I,E){var H=O.getData(),F=H.jsNode,K=F.properties,B=H.displayName,D=F.isContainer,G=F.isLink,J=B.substring(B.lastIndexOf(".")),A=F.nodeRef.nodeRef;var L;if(window.location.href.search(/\/sharedfiles/)!=-1&&H.location.path.search("/Shared")==0){H.location.path=H.location.path.substring(7)}I.width=this.thumbnailColumnWidth;b.setStyle(M,"width",I.width+"px");b.setStyle(M.parentNode,"width",I.width+"px");if(D||(G&&F.linkedNode.isContainer)){M.innerHTML='<span class="folder">'+(G?'<span class="link"></span>':"")+(N.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(N,H)+'<img id="'+A+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-64.png" /></a>';L=new YAHOO.util.DDTarget(A)}else{M.innerHTML='<span class="thumbnail">'+(G?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(N,H)+'<img id="'+A+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(H)+'" alt="'+J+'" title="'+r(B)+'" /></a></span>'}var C=new Alfresco.DnD(A,N)},renderCellDescription:function q(A,H,Y,N,S){var V="",U,T,E=Y.getData(),W=E.jsNode,I=W.properties,J=W.isContainer,K=W.isLink,ac="",Q="",F="",G=W.permissions.user.CreateChildren;if(W.isLink){Y.setData("displayName",E.fileName.replace(/(.url)$/,""))}else{if(I.title&&A.options.useTitle){Q='<span class="title">('+r(E.fileName)+")</span>"}}if(!W.hasAspect("cm:workingcopy")&&w(E.version)&&!W.isContainer&&!W.isLink){F='<span class="document-version">'+r(E.version)+"</span>"}E._filenameId=Alfresco.util.generateDomId();var R=E.metadataTemplate;if(R){if(YAHOO.lang.isArray(R.banners)){var aa=function D(af,ah,ae){var ad=(ae!==null?A.msg(ae)+": ":""),ag="";if(A.renderers.hasOwnProperty(af)&&typeof A.renderers[af]==="function"){ag=A.renderers[af].call(A,E,ad)}else{if(W.hasProperty(af)){ag='<span class="item">'+ad+A.renderProperty(W.properties[af])+"</span>"}}return ag};var P,ab;for(U=0,T=R.banners.length;U<T;U++){ab=R.banners[U];if(!w(ab.view)||ab.view==this.metadataBannerViewName){P=YAHOO.lang.substitute(ab.template,A.renderers,aa);if(w(P)){V+='<div class="info-banner">'+P+"</div>"}}}}if(YAHOO.lang.isString(R.title)){var X=function C(af,ah,ae){var ad=(ae!==null?"<em>"+A.msg(ae)+"</em>: ":""),ag="";if(A.renderers.hasOwnProperty(af)&&typeof A.renderers[af]==="function"){ag=A.renderers[af].call(A,E,ad)}else{if(W.hasProperty(af)){ag='<div class="filename">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(A,E);ag+=ad+A.renderProperty(W.properties[af])+"</a></span></div>"}}return ag};V+=YAHOO.lang.substitute(R.title,A.renderers,X)}else{if(W.hasPermission("Write")&&!W.isLocked&&!W.hasAspect("cm:workingcopy")){A.insituEditors.push({context:E._filenameId,params:{type:"textBox",nodeRef:W.nodeRef.toString(),name:"prop_cm_name",value:E.fileName,fnSelect:function M(ae,af){var ad=af.lastIndexOf(Alfresco.util.getFileExtension(af))-1;if(ad>0){Alfresco.util.selectText(ae,0,ad)}else{ae.select()}},validations:[{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:A.msg("validation-hint.length.min.max",1,255)},{type:Alfresco.forms.validation.nodeName,when:"keyup",message:A.msg("validation-hint.nodeName")}],title:A.msg("tip.insitu-rename"),errorMessage:A.msg("message.insitu-edit.name.failure")},callback:{fn:A._insituCallback,scope:A,obj:E}})}V+='<h3 class="filename"><span id="'+E._filenameId+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(A,E);V+=r(E.displayName)+"</a></span>"+Q+F+"</h3>"}if(YAHOO.lang.isArray(R.lines)){var Z=function L(af,ah,ae){var ad=(ae!==null?"<em>"+A.msg(ae)+"</em>: ":""),ag="";if(A.renderers.hasOwnProperty(af)&&typeof A.renderers[af]==="function"){ag=A.renderers[af].call(A,E,ad)}else{if(W.hasProperty(af)){ag='<span class="item">'+ad+A.renderProperty(W.properties[af])+"</span>"}}return ag};var P,O;for(U=0,T=R.lines.length;U<T;U++){O=R.lines[U];if(!w(O.view)||O.view==this.metadataLineViewName){P=YAHOO.lang.substitute(O.template,A.renderers,Z);if(w(P)){V+='<div class="detail">'+P+"</div>"}}}}}H.innerHTML=V;z.on(b.getElementsByClassName("banner-more-info-link","span",H),"click",function B(ad){A.onCloudSyncIndicatorAction(E,z.getTarget(ad))},{},A)},renderCellActions:function s(A,C,B,D,E){D.width=this.actionsColumnWidth;b.setStyle(C,"width",D.width+"px");b.setStyle(C.parentNode,"width",D.width+"px");b.addClass(C.parentNode,B.getData("type"));C.innerHTML='<div id="'+A.id+"-actions-"+B.getId()+'" class="hidden"></div>'},fnRenderCellProperty:function t(){var A=this;return function B(D,C,E,F){A.renderCellProperty(A,D,C,E,F)}},renderCellProperty:function v(H,G,I,E,A){if(typeof this.parentDocumentList.renderers[E.field]==="function"){G.innerHTML=this.parentDocumentList.renderers[E.field].call(this.parentDocumentList,I.getData(),"")}else{var D=I.getData(),B=D.jsNode,F=B.properties,C=F[E.field];if(C!=null){G.innerHTML='<span class="alf-generic-property">'+this.parentDocumentList.renderProperty(C)+"</span>"}}},fnRenderCellLinkProperty:function x(){var B=this;return function A(D,C,E,F){B.renderCellLinkProperty(B,D,C,E,F)}},renderCellLinkProperty:function c(H,G,I,E,A){var D=I.getData(),B=D.jsNode,F=B.properties,C=F[E.field];if(C!=null){G.innerHTML='<span class="link">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(H.parentDocumentList,D)+this.parentDocumentList.renderProperty(C)+"</a></span>"}},getDataTableRecordIdFromRowElement:function y(B,C){if(B!=null&&C!=null){var A=C;if(!b.hasClass(C,this.rowClassName)){A=b.getAncestorByClassName(C,this.rowClassName)}return A!==null?A.id:null}},getRowElementFromDataTableRecord:function k(A,B){if(A!=null&&B!=null){return A.widgets.dataTable.getTrEl(B)}},getRowSelectElementFromDataTableRecord:function i(A,B){if(A!=null&&B!=null){return b.get("checkbox-"+B.getId())}},onEventHighlightRow:function h(B,P,E){B.widgets.dataTable.onEventHighlightRow.call(B.widgets.dataTable,P);var H;if(E){H=E}else{H=P.target}var A=b.get(B.id+"-actions-"+H.id);if(A&&A.firstChild===null){var R=B.widgets.dataTable.getRecord(this.getDataTableRecordIdFromRowElement(B,H));if(R!==null){var D=R.getData(),Q=D.jsNode,I=D.actions,K=document.createElement("div"),M="",C;D.actionParams={};for(var N=0,J=I.length;N<J;N++){M+=B.renderAction(I[N],D)}K.innerHTML=YAHOO.lang.substitute(M,B.getActionUrls(D));b.addClass(K,"action-set");b.addClass(K,this.actionsCssClassName);C=YAHOO.util.Selector.query("div",K);if(C.length>B.options.actionsSplitAt+this.actionsSplitAtModifier){var F=b.get(B.id+"-moreActions").cloneNode(true),O=YAHOO.util.Selector.query("div",F);b.insertBefore(O[0],C[B.options.actionsSplitAt]);b.insertBefore(O[1],C[B.options.actionsSplitAt]);var G,L=C.slice(B.options.actionsSplitAt);for(G in L){if(L.hasOwnProperty(G)){O[1].appendChild(L[G])}}}A.appendChild(K)}}if(!b.hasClass(document.body,"masked")){B.currentActionsMenu=A;b.removeClass(A,"hidden")}},onEventUnhighlightRow:function f(B,E,D){B.widgets.dataTable.onEventUnhighlightRow.call(B.widgets.dataTable,E);var A;if(D){A=D}else{A=E.target}var C=b.get(B.id+"-actions-"+(A.id));if(C||b.hasClass(document.body,"masked")){if(B.hideMoreActionsFn){B.hideMoreActionsFn.call(this)}b.addClass(C,"hidden")}},onActionShowMore:function u(H,C,D){b.addClass(D.firstChild,"highlighted");var I=b.getNextSibling(D);var F=window.scrollY;if(F===undefined){F=document.documentElement.scrollTop}var A=b.getViewportHeight()-(b.getY(D)-F+D.offsetHeight);b.removeClass(I,"hidden");if(I.offsetHeight>A){b.setY(I,b.getY(D)-(I.offsetHeight+1))}var B=b.getX(D)+D.offsetWidth;var G=b.getX(I)+I.offsetWidth;if(B!=G){b.setX(I,(b.getX(D)+D.offsetWidth-I.offsetWidth))}H.hideMoreActionsFn=function E(){H.hideMoreActionsFn=null;b.removeClass(D.firstChild,"highlighted");b.addClass(I,"hidden")}},onFileRenamed:function e(D,B,A){var F=A[1];if(F&&(F.file!==null)){var E=D._findRecordByParameter(F.file.node.nodeRef,"nodeRef");if(E!==null){D.widgets.dataTable.updateRow(E,F.file);var C=D.widgets.dataTable.getTrEl(E);Alfresco.util.Anim.pulse(C)}}},onHighlightFile:function m(E,C,B){var H=B[1];if((H!==null)&&(w(H.fileName))){Alfresco.logger.debug("DL_VR_onHighlightFile: ",H.fileName);var G=E._findRecordByParameter(H.fileName,"displayName");if(G!==null){var D=this.getRowElementFromDataTableRecord(E,G),F=b.getY(D);if(YAHOO.env.ua.ie>0){F=F-(document.body.clientHeight/3)}else{F=F-(window.innerHeight/3)}window.scrollTo(0,F);Alfresco.util.Anim.pulse(D);E.options.highlightFile=null;var A=this.getRowSelectElementFromDataTableRecord(E,G);A.checked=true;E.selectedFiles[G.getData("nodeRef")]=true;YAHOO.Bubbling.fire("selectedFilesChanged")}}},_setEmptyDataSourceMessage:function g(B,A){B.widgets.dataTable.set("MSG_EMPTY",A)},renderEmptyDataSourceHtml:function o(N,J){var K=N;var C=K.doclistMetadata.itemCounts,G=(C.documents===0&&C.folders===0),I=(C.documents===0&&!K.options.showFolders&&C.folders>0);var F=function H(R){var P=b.getChildren(R);for(var O=0,Q=P.length;O<Q;O++){if(P[O].id!==null&&P[O].id!==""){P[O].id+="-instance"}}};var M=b.get(K.id+"-main-template"),E=M.cloneNode(true),B=b.getFirstChild(E),D=null,A=null;if(J){K._userCanUpload=K.doclistMetadata.parent.permissions.user.CreateChildren&&YAHOO.env.ua.mobile===null;K._removeDragAndDrop();if(K.currentFilter.filterId==="path"||K.currentFilter.filterId==="favourites"){K._addDragAndDrop()}if(K._userCanUpload&&K.dragAndDropEnabled){b.addClass(B,"docListInstructionsWithDND")}else{b.addClass(B,"docListInstructions")}if(G&&!K._userCanUpload){M=b.get(K.id+"-no-items-template");D=M.cloneNode(true);b.removeClass(D,"hidden");B.appendChild(D)}else{if(I){M=b.get(K.id+"-hidden-subfolders-template");D=M.cloneNode(true);b.removeClass(D,"hidden");F(D);A=b.getElementsByClassName("docListLinkedInstruction","a",D);if(A.length==1){A[0].innerHTML=K.msg("show.folders",C.folders)}B.appendChild(D)}else{if(G&&K._userCanUpload&&K.dragAndDropEnabled){M=b.get(K.id+"-dnd-instructions-template");D=M.cloneNode(true);b.removeClass(D,"hidden");B.appendChild(D)}else{if(G&&K._userCanUpload&&!K.dragAndDropEnabled){M=b.get(K.id+"-upload-instructions-template");D=M.cloneNode(true);b.removeClass(D,"hidden");F(D);B.appendChild(D)}}}}if(G&&K._userCanUpload&&K.dragAndDropEnabled){M=b.get(K.id+"-other-options-template");D=M.cloneNode(true);b.removeClass(D,"hidden");B.appendChild(D);if(G&&K._userCanUpload){if(K.dragAndDropEnabled){M=b.get(K.id+"-standard-upload-template");D=M.cloneNode(true);b.removeClass(D,"hidden");F(D);B.appendChild(D)}M=b.get(K.id+"-new-folder-template");D=M.cloneNode(true);b.removeClass(D,"hidden");F(D);B.appendChild(D)}}}else{b.addClass(B,"docListInstructions");if(I){M=b.get(K.id+"-hidden-subfolders-template");D=M.cloneNode(true);b.removeClass(D,"hidden");F(D);A=b.getElementsByClassName("docListLinkedInstruction","a",D);if(A.length==1){A[0].innerHTML=K.msg("show.folders",C.folders)}B.appendChild(D)}else{M=b.get(K.id+"-no-items-template");D=M.cloneNode(true);b.removeClass(D,"hidden");B.appendChild(D)}}var L=document.createElement("div");b.setStyle(L,"clear","both");B.appendChild(L);this._setEmptyDataSourceMessage(K,E.innerHTML)}}})();
